<!doctype html>
<html>
  <head>
    <title>My first VR site</title>
    <script src="https://aframe.io/releases/latest/aframe.min.js"></script>
  </head>
  <body>
    <a-scene id="scene1">
      <a-camera
								position="0 1.8 4" 
								cursor-visible="true" 
								cursor-scale="2" 
								cursor-color="#4CC3D9" 
								cursor-offset="2" 
								cursor-maxdistance="100" 
								cursor-opacity="0.5">
			</a-camera>
			<a-light position="-3 2 7"></a-light>
		</a-scene>
  </body>
	<script src="./gl-matrix-min.js"></script>
	<script>
		var toggleLine = function(id1, id2, lineId, colorOn) {
			var el1 = document.getElementById(id1);
			var el2 = document.getElementById(id2);
			var lineEl = document.getElementById(lineId);
			var el1On = el1.getAttribute('material').color === colorOn;
			var el2On = el2.getAttribute('material').color === colorOn;
			(el1On && el2On) ?
				lineEl.setAttribute('visible', 'true') :
			  lineEl.setAttribute('visible', 'false');
		};
		var toggleElColor = function(el, color1, color2, lineMap) {
			return function() {
				(el.getAttribute('material').color === color1) ?
					el.setAttribute('material', 'color', color2) :
					el.setAttribute('material', 'color', color1);	
				
				for(var i = 0; i < lineMap.length; i++) {
					toggleLine('point'+lineMap[i][0], 'point'+lineMap[i][1], 'line'+lineMap[i], color2);
				}
			}
		};
		var point = {
			id: 'point',
			geometry: {
				primitive: 'box',
				depth: 0.5,
				width: 1,
				height: 1
			},
			material: {
				color: 'gray',
				metalness: 1
			},
			position: {
				x: -1,
				y: 0,
				z: -2
			}
		};
		var line = {
			id: 'line',
			geometry: {
				primitive: 'cylinder',
				radius: 0.1,
				height: 2
			},
			material: {
				color: 'white',
				metalness: 0
			},
			rotation: {
				x: 0,
				y: 0,
				z: 90
			},
			position: {
				x: 0,
				y: 0,
				z: -2
			},
			visible: 'false'
		};
		
		var pointPositions = [{x:-2,y:-1,z:-2}, {x:1,y:0,z:-2}, {x:-1,y:2,z:-2}];
		var lineMap = ['10', '12', '20'];
		
		var scene = document.getElementById('scene1');
		
		//points
		for(var i = 0; i < pointPositions.length; i++) {
			var ett = document.createElement('a-entity');
			ett.setAttribute('id', point.id + i);
			ett.setAttribute('geometry', point.geometry);
			ett.setAttribute('material', point.material);
			ett.setAttribute('position', pointPositions[i]);
			scene.appendChild(ett);
			ett.onmouseenter = toggleElColor(ett, point.material.color, 'red', lineMap);
		}
		
		//lines
		var calcMidPos = function(pos1, pos2) {
			return {x: (pos1.x+pos2.x)/2, y: (pos1.y+pos2.y)/2, z: (pos1.z+pos2.z)/2};
		};
		for(var i = 0; i < lineMap.length; i++) {
			var i1 = parseInt(lineMap[i][0]);
			var i2 = parseInt(lineMap[i][1]);
			
			// line center position
			var pos = calcMidPos(pointPositions[i1], pointPositions[i2]);
			
			// line rotation
			var v1 = vec3.fromValues(
				pointPositions[i2].x - pointPositions[i1].x,
				pointPositions[i2].y - pointPositions[i1].y,
				pointPositions[i2].z - pointPositions[i1].z
			);
			var ref = vec3.fromValues(0, 1, 0);
			var angle = vec3.angle(v1, ref)*180/Math.PI;
			var rot = {x:0,y:0,z:angle};
			
			// line height
			var height = vec3.len(v1);
			
			var ett = document.createElement('a-entity');
			ett.setAttribute('id', line.id + lineMap[i]);
			ett.setAttribute('geometry', line.geometry);
			ett.setAttribute('geometry', 'height', height);
			ett.setAttribute('material', line.material);
			ett.setAttribute('rotation', rot);
			ett.setAttribute('position', pos);
			ett.setAttribute('visible', line.visible);
			scene.appendChild(ett);
		}
	</script>
</html>